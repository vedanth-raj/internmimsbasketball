<!DOCTYPE html>
<html>
<head>
    <title>Firebase Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #333; color: white; }
        .status { padding: 10px; margin: 5px 0; border-radius: 5px; }
        .success { background: #22c55e; }
        .error { background: #ef4444; }
        .info { background: #3b82f6; }
        button { padding: 10px 20px; margin: 5px; background: #ff6b35; color: white; border: none; border-radius: 5px; cursor: pointer; }
        pre { background: #222; padding: 10px; border-radius: 5px; overflow: auto; }
    </style>
</head>
<body>
    <h1>ðŸ”¥ Firebase Debug Console</h1>
    <div id="status"></div>
    
    <h2>Controls</h2>
    <button onclick="initMatch()">Initialize Match</button>
    <button onclick="updateScore('A', 10)">Set Team A Score to 10</button>
    <button onclick="updateScore('B', 15)">Set Team B Score to 15</button>
    <button onclick="startTimer()">Start Timer</button>
    <button onclick="addTestPlayer()">Add Test Player</button>
    <button onclick="readData()">Read All Data</button>

    <h2>Live Data</h2>
    <pre id="data-display">Waiting for data...</pre>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js';
        import { getDatabase, ref, set, update, onValue } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAWCSuJ4CFUy_mIiVJSECc8hGZok3yfWnY",
            authDomain: "internmimsbasketball.firebaseapp.com",
            databaseURL: "https://internmimsbasketball-default-rtdb.firebaseio.com",
            projectId: "internmimsbasketball",
            storageBucket: "internmimsbasketball.firebasestorage.app",
            messagingSenderId: "97822648007",
            appId: "1:97822648007:web:cfc93e3a6fb8233c6c40e2",
            measurementId: "G-KM2NGQ30TJ"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        function addStatus(message, type) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            document.getElementById('status').appendChild(div);
        }

        // Listen to data changes
        const matchRef = ref(database, 'matches/current');
        onValue(matchRef, (snapshot) => {
            const data = snapshot.val();
            document.getElementById('data-display').textContent = JSON.stringify(data, null, 2);
            if (data) {
                addStatus('Data updated: ' + JSON.stringify(data), 'info');
            }
        });

        // Global functions
        window.initMatch = async () => {
            try {
                const matchData = {
                    teamA: 'NMIMS Mumbai',
                    teamB: 'NMIMS Hyderabad',
                    scoreA: 0,
                    scoreB: 0,
                    timer: "12:00",
                    isRunning: false,
                    quarter: 1,
                    players: {},
                    lastUpdated: Date.now()
                };
                await set(ref(database, 'matches/current'), matchData);
                addStatus('Match initialized successfully', 'success');
            } catch (error) {
                addStatus('Error: ' + error.message, 'error');
            }
        };

        window.updateScore = async (team, score) => {
            try {
                const updates = {};
                updates[`matches/current/score${team}`] = score;
                updates['matches/current/lastUpdated'] = Date.now();
                await update(ref(database), updates);
                addStatus(`Team ${team} score updated to ${score}`, 'success');
            } catch (error) {
                addStatus('Error updating score: ' + error.message, 'error');
            }
        };

        window.startTimer = async () => {
            try {
                const updates = {};
                updates['matches/current/isRunning'] = true;
                updates['matches/current/lastUpdated'] = Date.now();
                await update(ref(database), updates);
                addStatus('Timer started', 'success');
            } catch (error) {
                addStatus('Error starting timer: ' + error.message, 'error');
            }
        };

        window.addTestPlayer = async () => {
            try {
                const playerId = 'player_' + Date.now();
                const playerData = {
                    name: 'Test Player',
                    team: 'A',
                    points: 5,
                    fouls: 1
                };
                const updates = {};
                updates[`matches/current/players/${playerId}`] = playerData;
                updates['matches/current/lastUpdated'] = Date.now();
                await update(ref(database), updates);
                addStatus('Test player added', 'success');
            } catch (error) {
                addStatus('Error adding player: ' + error.message, 'error');
            }
        };

        window.readData = async () => {
            try {
                // This will trigger the onValue listener
                addStatus('Reading data...', 'info');
            } catch (error) {
                addStatus('Error reading data: ' + error.message, 'error');
            }
        };

        addStatus('Firebase debug console loaded', 'success');
    </script>
</body>
</html>